```{r, message=FALSE, warning=FALSE}
library(magrittr)
library(abind)
```

```{r}
source("watermazer_methods.R")

par(mfrow=c(1,2))

# Parameters
im_path = "pivideoh02.mp4"
fps = 5
duration = 30
start_frame = 1

# Tracking
video = load_video(im_path, fps, duration, start_frame)

mask = select_mask(video, frame=5, threshold=.3, dilation=100)
inspect_mask(video, mask, frame=1)

tracking = track(video, mask, smoothing=F)
inspect_tracking(tracking)
save_tracking(path="tracking_output.csv", tracking)

# Representative video output
create_tracking_video(
  tracking, in_path=im_path, out_path="tracking_output.mp4", 
  fps, duration, start_frame)
```


