```{r}
par(mfrow=c(1,2))

# Parameters
im_path = "pivideoh02.mp4"
fps = 25
duration = 10
start_frame = 1

# Tracking
video = load_video(im_path, fps, duration, start_frame)

mask = select_mask(video, frame=5, threshold=.3, dilation=100)
inspect_mask(video, mask, frame=1)

tracking = track(video, mask, smoothing=F)
inspect_tracking(tracking)

# Mouse centric view
centered_frames = sapply(1:nrow(tracking), function(i) {
  video[[i]] %>%
    imager::subim(
      x<tracking$x[i]+50, x>tracking$x[i]-50,
      y<tracking$y[i]+50, y>tracking$y[i]-50)
}, simplify=F)

video_cropped = imager::imappend(centered_frames, "z")
imager::save.video(video_cropped, fps=fps/5, fname="mouse_centered-slow.mp4")
```

